<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.practice.board.dao.IBoardDAO">
	<select id="getBoardList" parameterType="com.spring.practice.common.dto.SearchDTO" resultType="BoardDTO">
		SELECT * FROM (
			SELECT
				a.*
				, ROWNUM AS RNUM
			FROM (
				SELECT
				    a.bo_no
				    , a.bo_title
				    , a.bo_con
				    , a.mem_id
				    , b.mem_nm
				    , TO_CHAR(a.bo_date, 'MM.dd') AS bo_date
				FROM boardss a, memberss b
				WHERE 1=1
					AND a.mem_id = b.mem_id
					AND a.del_yn = 'N'
				<if test="searchWord != null">
					<choose>
						<when test="searchOption == 'title'">AND a.bo_title LIKE '%' || #{searchWord} || '%'</when>
						<when test="searchOption == 'content'">AND a.bo_con LIKE '%' || #{searchWord} || '%'</when>
						<when test="searchOption == 'name'">AND b.mem_nm LIKE '%' || #{searchWord} || '%'</when>
					</choose>
				</if>
				ORDER BY bo_no DESC
			)a
		)
		WHERE rnum BETWEEN #{firstRow} AND #{lastRow}
	</select>
	
	<insert id="writeBoard" parameterType="BoardDTO">
		INSERT INTO boardss(
		    bo_no
		    , bo_title
		    , mem_id
		    , bo_con
		    , bo_date
		    , del_yn
		) VALUES (
		    (SELECT COUNT(*)+1 FROM boardss)
		    , #{boTitle}
		    , #{memId}
		    , #{boCon}
		    , SYSDATE
		    , 'N'
		)
	</insert>
	
	<select id="getBoard" resultType="BoardDTO">
		SELECT
		    a.bo_no
		    , a.bo_title
		    , b.mem_id
		    , a.bo_con
		    , TO_CHAR(a.bo_date, 'YYYY-MM-dd hh24:mm') AS bo_date
		FROM
		    boardss a, memberss b
		WHERE 1=1
		    AND a.mem_id = b.mem_id
		    AND a.bo_no = #{boNo}
		    AND a.del_yn = 'N'
	</select>
	
	<update id="editBoard" parameterType="BoardDTO">
		UPDATE
		    boardss
		SET
		    bo_title = #{boTitle}
		    , bo_con = #{boCon}
		WHERE 1=1
		    AND bo_no = #{boNo}
	</update>
	
	<update id="deleteBoard">
		UPDATE
		    boardss
		SET
		    del_yn = 'Y'
		WHERE 1=1
		    AND bo_no = #{boNo}
	</update>
</mapper>